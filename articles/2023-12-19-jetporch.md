---
title: "【Rust製構成管理ツール】JetPorch とは【次世代Ansible？】"
emoji: "🚢"
type: "tech"
topics: ["jetporch", "rust", "ansible"]
published: false
---

本記事は [KMC Advent Calendar 2023](https://adventar.org/calendars/8840) と [KLab Engineer Advent Calendar 2023](https://qiita.com/advent-calendar/2023/klab) の 19 日目の記事です.

## TL;DR

- JetPorch は による新しい Rust 製構成管理ツール
- Ansible の開発者である Michael DeHaan によって開発
- 実行速度, 強力な並列性
- ユーザーが
- リモートサーバーに Python を必要としない

## 本記事の目的

最近 JetPorch という構成管理ツールがリリースされたのを知り, 自分が個人的に使っている Ansible の移行先として興味を持ったので調べてみました.

https://x.com/polleninjp/status/1711442891883807138

> Jet
> Ansible のソースが Any 型ばかりで読みにくく泣きそうだった中見つけた
> ちょっと追っていきたい

## JetPorch とは

JetPorch は, **Ansible の開発者である [Michael DeHaan](https://github.com/mpdehaan)** による新しい**構成管理ツール**です.

基本的なコンセプトは Ansible とよく似ていますが, 昨今の複雑な自動化に対応するため Ansible では足りない部分・実現困難な部分を Michael DeHaan さん自らが見直し改善しています.
また, Ansible が Python で書かれているのに対し JetPorch はより強い型システムや強力な並列性をサポートする **Rust** で書かれています. より学習しやすくユーザーにシンプルに映ること[^jetporch_goal_simplicity][^save_user_time_to_do_other_things]も目的の一つとされています.

[^jetporch_goal_simplicity]:
    > I would like to see a move back towards minimalism, grocery-list style simplicity [^jetporch_first_blog]

[^save_user_time_to_do_other_things]:
    > The goal is to deploy or automate things and get you more time to do something else. [^jetPorch_dev_blog_1]

2023 年 10 月 に v0.1.0 として初リリースされ, SourceHut にてソースの公開・管理が行われています[^development_on_sourcehut].

[^development_on_sourcehut]: [SourceHut - JetPorch Documentation](https://www.jetporch.com/community/sourcehut)

- <https://www.jetporch.com/>
- <https://git.sr.ht/~mpdehaan/jetporch>

![Image from Gyazo](https://i.gyazo.com/c3b8c62d6bc96bb32c08ae6f71789542.png)

## 基本コンセプト

基本的なイメージは Ansible と同じです. JetPorch を実行するコントロールマシンから操作対象のリモートサーバーに対して, **SSH**[^more_strong_style_over_ssh]で並列に命令を送り, 数台から数千台以上の規模[^more_strong_style_over_ssh]のサーバーを一括で操作・構成管理することが目的です.

![Image from Gyazo](https://i.gyazo.com/5be5145a979c5a8ff7192bd4468c656d.png)

## Ansible と比較した特徴

同様の既存ツールである Ansible と比較すると以下のような特徴を持っています.

|                                | Ansible                                                 | **JetPorch**                                             |
| :----------------------------- | :------------------------------------------------------ | :------------------------------------------------------- |
| core の開発言語                | Python                                                  | **Rust**                                                 |
| リモートサーバーへの必要ツール | Python が必要                                           | **無し** (Bash)                                          |
| 実行速度 (並列性)              | 遅い                                                    | **速い**                                                 |
| ユーザーの学習コスト (複雑さ)  | 高い                                                    | **低** くなるように慎重に実装[^jetporch_goal_simplicity] |
| Playbook / Template 評価       | 実行時評価                                              | **実行前評価**                                           |
| 命令の仕方                     | Push 型 ( / Pull 型[^ansible_pull])                     | Push 型 ( / Pull 型(実装予定))                           |
| 命令の送信方法                 | SSH                                                     | SSH ( + α[^more_strong_style_over_ssh] (実装予定) )      |
| モジュールの言語               | 何でも[^module_language]                                | 何でも[^module_language]                                 |
| 3rd party モジュール           | 多数 ([Ansible Galaxy 等](https://galaxy.ansible.com/)) | 今後の広がりに期待                                       |

[^module_language]: 対応した JSON での入出力が可能な形態になっていればモジュール化可能. [^jetporch_dev_blog_1]
[^more_strong_style_over_ssh]:
    > Support local connectivity, SSH, and new message bus deployment architectures supporting potentially 50k-100k systems at once.
    > [A New IT Automation Project? Moving Beyond Ansible And Keeping The Spirit - An Invitation](https://laserllama.substack.com/p/a-new-it-automation-project-moving)

[^ansible_pull]: [ansible-pull — Ansible Documentation](https://docs.ansible.com/ansible/latest/cli/ansible-pull.html)

自動化が当たり前になった昨今ではシステムが複雑化しつつあり 10 年以上前に作られた Ansible にも様々な問題がでてきました. JetPorch はそんな Ansible をよりユーザーにとってシンプルで学びやすいものにすることを目指し, 複雑化したシステム需要に対応しようということでプロジェクトが開始されたようです[^jetporch_first_blog].

[^jetporch_first_blog]: [A New IT Automation Project? Moving Beyond Ansible And Keeping The Spirit - An Invitation.](https://laserllama.substack.com/p/a-new-it-automation-project-moving)

---

## 使い方

ここからは簡単なサンプルを用いて JetPorch の使い方を紹介します. Ansible を使ったことがない人に対してもわかるように説明しますが, Ansible を使ったことがある人は殆ど変わらぬ使用感で使うことができると思います.

利用者側の構成要素は以下の２つ要素から成り立っています.

- **Inventory** ... 操作対象のサーバーの情報を記述したファイル群
- **Playbook** ... 操作対象のサーバーに対して実行するタスクを記述したファイル群

![Image from Gyazo](https://i.gyazo.com/3a2da1c16b2f92eb3eaef3c403f2d429.png)

## Ansible の問題点と JetPorch による解決策

## 個人的に感じたクセ

- clippy のスタイルの一部を嫌っている
- SourceNuts
- CLI 部分にはあえて clap などのライブラリは使っていない
  - できるだけ外部ライブラリに依存しないようにしている

[^jetPorch_dev_blog_1]: [JetPorch Dev Blog #1 - by laserllama](https://jetporch.substack.com/p/jetporch-dev-blog-1)
