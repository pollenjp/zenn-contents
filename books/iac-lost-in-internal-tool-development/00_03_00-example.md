---
title: "絶えず変化を求められる"
---

ここではこのピラミッド構造の解像度を高め、具体的な課題を例示し、それに伴う各々の作業について説明します。

## 利用側の依頼

ここの課題には様々なものが想定できますが、ここでは小さめの課題として以下のような要求があると仮定します。

- 課題[^サンプル課題]: **納品された画像に自動で特定の処理を施したい**
- 依頼者: 制作さん (非エンジニア)

[^サンプル課題]: IaC 周りを強調したいため、ビジネスロジック周りはシンプルにしています。

この時点ではまだ要求段階であり、どのようにして問題を解決するべきなのか、どのようなインターフェースが最適なのかはまだ明確ではありません。

なるべくツール開発を担当するエンジニアとのコミュニケーションを通じてここを詰めていくことになりますが最初から完璧を求めるのは難しいでしょう。

最初のリリース以降も Feedback と改修を繰り返し少しずつ磨いていくのが理想となります。

## 要件

話し合いの結果、とりあえずこの時点で決めることができる要件を以下のように決定しツール開発を行いました。

- ブラウザで操作できること
- まとめて画像のアップロードができること
- 処理済みの画像を一括でダウンロードできること
- 処理はサーバー上で行うこと (ローカルアプリではない)
  - 特定の処理を行うには社内のシステムとのやり取りが必要となるため

[![Image from Gyazo](https://i.gyazo.com/4f9f31d633b29037f4f5830fd51d3f37.png)](https://gyazo.com/4f9f31d633b29037f4f5830fd51d3f37)

この App (Backend + Frontend) をローカルで動かせる状態になったら、デプロイして利用側にサービス提供できる状態を試みます。

先に示したピラミッドの分類に従うと以下のように分けることができるでしょう。

[![Image from Gyazo](https://i.gyazo.com/7f908440e9bd5e801c882a63756939c4.png)](https://gyazo.com/7f908440e9bd5e801c882a63756939c4)

## 手動でデプロイする

AWS 上で EC2 (ただの Linux マシン) を確保し、 systemd でアプリケーションを動かすことを考えてみましょう。

何も考えずに手動でデプロイする場合は以下のような作業が必要になります。

- ハードウェア調達・準備 (AWS)
  - 基本は AWS コンソール 上での作業 (マウスぽちぽち)
  - EC2 インスタンスを作成
  - Route53 でドメインを確保し、EC2 インスタンスに割り当て
  - その他、証明書やセキュリティグループ等の設定
- デプロイ・環境構築 (systemd)
  - EC2 サーバーに直に SSH して作業
  - 依存するツールのインストール
    - パッケージマネージャによるインストールやバイナリの直配置
    - それぞれのツールの設定ファイル等を書き換え
  - systemd による設定と起動
    - それぞれのツールを起動するために systemd の service ファイルを作成
      - 起動設定
      - 環境変数の設定
    - 順次 systemd start で起動

ここまでやってやっと依頼者に利用してもらうことができるようになります。

## 開発は継続するもの

おすすめはしません[^quality_is_not_an_act_it_is_a_habit][^market_pressure_is_never_stop]が、リリースを急かされている場合はこのように手動でデプロイすることもあるでしょう。 しかし、ここで手を止めてしまったら崩壊の始まりです。

[^quality_is_not_an_act_it_is_a_habit]: Quality is not an act, it is a habit. (アリストテレス) / できる人は当たり前に最初から IaC 周りを考慮しているように感じます。
[^market_pressure_is_never_stop]: 「あとでクリーンにすればいいよ. 先に市場に出さなければ!」 開発者たちはそうやっていつもごまかす. だが, あとでクリーンにすることはない. 市場からのプレッシャーは止まらないからだ. (『Clean Architecture 達人に学ぶソフトウェアの構造と設計』)

たとえ小さなアプリケーションだとしても初期リリース以降も、Feedback を元にコード改修は繰り返します。
内製ツールの場合そうやって Usability (使いやすさ) を高めていくことで会社のパフォーマンスにつながります。

:::message
偶に最初の要件定義段階でこれ以上仕様変更しないように要求元に圧をかける姿が想像されますが、それを行ったところで市場からあふれる変化の圧力が止まることはありません。結局、改善要求が降りかかるか、せっかく開発されたツールが使われなくなるか、あるいは改善したいことがあっても声を出せない環境を作り出すでしょう。
:::

[![Image from Gyazo](https://i.gyazo.com/9be5519fd4f9e12bbf652ca7d1efcca0.png)](https://gyazo.com/9be5519fd4f9e12bbf652ca7d1efcca0)

改善を行っていくにはコード自身に対する変更容易性 (Modifiability) や運用性 (Operability) 等も向上させ、継続的に発生する運用コストを最小化しなければなりません[^why_operability_is_important]。

[^why_operability_is_important]: 基本的に楽でない運用はミスを誘発[^why_operability_is_important_2]し、運用者にプレッシャーを与えるだけでなく、建設的なコード改善に当てる工数を奪います。
[^why_operability_is_important_2]:
    運用現場は楽じゃないとミスが起こる
    [Infrastructure as Code でセキュリティを楽にしよう ! #AWSDevLiveShow - YouTube](https://www.youtube.com/live/qr_Fx_ENjxE?si=tGnLqBipnMmpTqlh&t=380)

必然的にアプリケーションは何度も改修され、細かくデプロイすることが求められます[^may_not_deploy_because_of_low_deployability]。
そこで「環境構築とデプロイ」レイヤに求められるのが **展開容易性 (Deployability)** であり、**再構築容易性 (Reconstructability)** になります。

[^may_not_deploy_because_of_low_deployability]: 本当にそんなに deploy するのか？と思った人がいるかも知れませんが、その場合は Deployability が低く触る勇気が持てないから次の deploy が起こらない可能性があります。

以降のセクションでは

- どうやってこれを可能にするのか
- この責任を放棄するとどのような崩壊のパンデミックが起こるのか

を考えていきます。
